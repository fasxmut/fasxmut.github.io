<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>day-25: Special: c++ modules gcc</title>
<link rel="stylesheet" href="boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets Vsnapshot">
<link rel="home" href="index.html" title="Learn c++ in days">
<link rel="up" href="index.html" title="Learn c++ in days">
<link rel="prev" href="day-24-cpp-stl-std-copy-std-fill.html" title="day-24: c++ STL: std::copy, std::fill">
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="spirit-nav">
<a accesskey="p" href="day-24-cpp-stl-std-copy-std-fill.html"><img src="images/prev.png" alt="Prev"></a><a accesskey="u" href="index.html"><img src="images/up.png" alt="Up"></a><a accesskey="h" href="index.html"><img src="images/home.png" alt="Home"></a>
</div>
<div class="article">
<div class="titlepage">
<div><div><h1 class="title">
<a name="day-25-special-cpp-modules-gcc"></a>day-25: Special: c++ modules gcc</h1></div></div>
<hr>
</div>
<p>
      <span class="dddgreen">The gcc used for this article is 16.0.0, built from
      gcc git source code. (Apr 24, 2025).</span>
    </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
          <a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.import-std">First: import
          std;</a>
        </li>
<li class="listitem">
          <a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.make-a-cpp-module">Next:
          Make a c++ module</a>
        </li>
<li class="listitem">
          <a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.modules-shared-library">Next:
          Modules Shared Library</a>
        </li>
<li class="listitem">
          <a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.module-partition">Next: Module
          Partition</a>
        </li>
<li class="listitem">
          <a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.header-unit">Next: Header
          Unit</a>
        </li>
<li class="listitem">
          <a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.split-definitions">Next:
          Split Definitions for Shared Library (Module Unit and Module Implementation
          Unit)</a>
        </li>
<li class="listitem">
          <a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.modules-in-b2-build">Next:
          c++ Modules in B2 Build System</a>
        </li>
<li class="listitem">
          <a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.glossary">Last: Glossary</a>
        </li>
</ul></div>
<p>
      <span class="bold"><strong>Alias gpp:</strong></span>
    </p>
<pre class="programlisting"><span class="bold"><strong>alias <span class="dred">gpp</span>="path/to/the/g++ -fmodules-ts -std=c++26"</strong></span>
</pre>
<h2>
<a name="day-25-special-cpp-modules-gcc.h0"></a>
      <span class="phrase"><a name="day-25-special-cpp-modules-gcc.import-std"></a></span><a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.import-std"><span class="cyan">First: import std;</span></a>
    </h2>
<p>
      <span class="bold"><strong>import declaration</strong></span>: import module units, module
      partitions, header units.
    </p>
<p>
      <span class="bold"><strong>Pre-compile gcc std.gcm :</strong></span>
    </p>
<pre class="programlisting"><span class="special">&gt;</span> <span class="identifier">gpp</span> <span class="special">-</span><span class="identifier">fsearch</span><span class="special">-</span><span class="identifier">include</span><span class="special">-</span><span class="identifier">path</span> <span class="identifier">bits</span><span class="special">/</span><span class="identifier">std</span><span class="special">.</span><span class="identifier">cc</span> <span class="special">-</span><span class="identifier">c</span>
<span class="special">&gt;</span> <span class="identifier">rm</span> <span class="identifier">std</span><span class="special">.</span><span class="identifier">o</span>
<span class="special">&gt;</span> <span class="identifier">ls</span> <span class="identifier">gcm</span><span class="special">.</span><span class="identifier">cache</span><span class="special">/</span>
<span class="identifier">std</span><span class="special">.</span><span class="identifier">gcm</span>
</pre>
<p>
      It will generate gcm.cache/std.gcm at current working directory.
    </p>
<p>
      Pre-compiling std.gcm is a little slow, after compiling it, the compiling of
      using of "import std;" is very fast.
    </p>
<p>
      <span class="bold"><strong>hello.cpp :</strong></span>
    </p>
<pre class="programlisting"><span class="identifier">import</span> <span class="identifier">std</span><span class="special">;</span>

<span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span>
<span class="special">{</span>
	<span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"Hello, c++ modules!"</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
<span class="special">}</span>
</pre>
<p>
      <span class="bold"><strong>Compile program hello.cpp:</strong></span>
    </p>
<p>
      (very fast)
    </p>
<p>
      After the cache <em class="replaceable"><code>gcm.cache/std.gcm</code></em> is generated,
      the compiling is super fast.
    </p>
<pre class="programlisting"><span class="special">&gt;</span> <span class="identifier">gpp</span> <span class="identifier">hello</span><span class="special">.</span><span class="identifier">cpp</span> <span class="special">-</span><span class="identifier">o</span> <span class="identifier">hello</span>
<span class="special">&gt;</span> <span class="special">./</span><span class="identifier">hello</span>
<span class="identifier">Hello</span><span class="special">,</span> <span class="identifier">c</span><span class="special">++</span> <span class="identifier">modules</span><span class="special">!</span>
</pre>
<p>
      The cache <span class="bold"><strong>./gcm.cache</strong></span> can be removed and you
      repeat above steps again, it works, you can try it!
    </p>
<p>
      The cache <span class="bold"><strong>./gcm.cache/std.gcm</strong></span> will be reused
      for the rest parts of this article conveniently.
    </p>
<h2>
<a name="day-25-special-cpp-modules-gcc.h1"></a>
      <span class="phrase"><a name="day-25-special-cpp-modules-gcc.make-a-cpp-module"></a></span><a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.make-a-cpp-module"><span class="cyan">Next: Make a c++ module</span></a>
    </h2>
<p>
      <span class="bold"><strong>export declaration:</strong></span>
    </p>
<p>
      c++ module declaration starts with a keyword export or module.
    </p>
<p>
      E.X:
    </p>
<p>
      <em class="replaceable"><code><span class="ddred">export module module-name;</span></code></em>
    </p>
<p>
      Declares a primary module interface unit and export, its name is module-name
      .
    </p>
<p>
      <em class="replaceable"><code><span class="ddred">export namespace namespace-name<br> {<br>
      ... </span></code></em>
    </p>
<p>
      export a namespace
    </p>
<p>
      <span class="dddgreen">Make a c++ module, source code: my_class.cppm</span>
      -&gt;
    </p>
<p>
      (<span class="dddred">Note that gcc supports both .cppm and .cpp as the c++
      module source code file name extension.</span>)
    </p>
<p>
      <span class="bold"><strong>my_class.cppm</strong></span> :
    </p>
<pre class="programlisting"><span class="keyword">export</span> <span class="identifier">module</span> <span class="identifier">my_module</span><span class="special">;</span>

<span class="identifier">import</span> <span class="identifier">std</span><span class="special">;</span>

<span class="keyword">export</span> <span class="keyword">namespace</span> <span class="identifier">my_space</span>
<span class="special">{</span>
	<span class="keyword">class</span> <span class="identifier">my_class</span>
	<span class="special">{</span>
	<span class="keyword">public</span><span class="special">:</span>
		<span class="keyword">void</span> <span class="identifier">greeting</span><span class="special">()</span> <span class="keyword">const</span>
		<span class="special">{</span>
			<span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"Cheers, c++!"</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
		<span class="special">}</span>
	<span class="special">};</span>
<span class="special">}</span>
</pre>
<p>
      Use the module, source code: main.cpp
    </p>
<p>
      <span class="bold"><strong>main.cpp</strong></span> :
    </p>
<pre class="programlisting"><span class="identifier">import</span> <span class="identifier">my_module</span><span class="special">;</span>

<span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span>
<span class="special">{</span>
	<span class="identifier">my_space</span><span class="special">::</span><span class="identifier">my_class</span> <span class="identifier">my_object</span><span class="special">;</span>
	<span class="identifier">my_object</span><span class="special">.</span><span class="identifier">greeting</span><span class="special">();</span>
<span class="special">}</span>
</pre>
<p>
      <span class="bold"><strong>Compile them</strong></span> :
    </p>
<pre class="programlisting"><span class="special">&gt;</span> <span class="identifier">gpp</span> <span class="identifier">my_class</span><span class="special">.</span><span class="identifier">cppm</span> <span class="identifier">main</span><span class="special">.</span><span class="identifier">cpp</span> <span class="special">-</span><span class="identifier">o</span> <span class="identifier">main</span>
<span class="special">&gt;</span> <span class="special">./</span><span class="identifier">main</span>
<span class="identifier">Cheers</span><span class="special">,</span> <span class="identifier">c</span><span class="special">++!</span>
</pre>
<p>
      The compiling order is compiling my_class.cppm first, then main.cpp
    </p>
<h2>
<a name="day-25-special-cpp-modules-gcc.h2"></a>
      <span class="phrase"><a name="day-25-special-cpp-modules-gcc.modules-shared-library"></a></span><a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.modules-shared-library"><span class="cyan">Next: Modules Shared Library</span></a>
    </h2>
<p>
      Just compile the module source c++ file to shared library.
    </p>
<p>
      <span class="bold"><strong>my_cpp.cppm</strong></span> :
    </p>
<pre class="programlisting"><span class="keyword">export</span> <span class="identifier">module</span> <span class="identifier">my_module</span><span class="special">;</span>
<span class="keyword">export</span> <span class="identifier">import</span> <span class="identifier">std</span><span class="special">;</span>
<span class="keyword">export</span> <span class="keyword">namespace</span> <span class="identifier">my_space</span>
<span class="special">{</span>
	<span class="keyword">class</span> <span class="identifier">my_class</span>
	<span class="special">{</span>
	<span class="keyword">private</span><span class="special">:</span>
		<span class="keyword">int</span> <span class="identifier">__x</span><span class="special">;</span>
	<span class="keyword">public</span><span class="special">:</span>
		<span class="identifier">my_class</span><span class="special">(</span><span class="keyword">int</span> <span class="identifier">x__</span><span class="special">):</span> <span class="identifier">__x</span><span class="special">{</span><span class="identifier">x__</span><span class="special">}</span> <span class="special">{}</span>
	<span class="keyword">public</span><span class="special">:</span>
		<span class="keyword">int</span> <span class="identifier">get</span><span class="special">()</span> <span class="keyword">const</span> <span class="special">{</span><span class="keyword">return</span> <span class="identifier">__x</span><span class="special">;}</span>
	<span class="special">};</span>
<span class="special">}</span>
</pre>
<p>
      <span class="bold"><strong>main.cpp</strong></span> :
    </p>
<pre class="programlisting"><span class="identifier">import</span> <span class="identifier">my_module</span><span class="special">;</span>
<span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span>
<span class="special">{</span>
	<span class="identifier">my_space</span><span class="special">::</span><span class="identifier">my_class</span> <span class="identifier">object</span><span class="special">{</span><span class="number">234</span><span class="special">};</span>
	<span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"get: "</span> <span class="special">&lt;&lt;</span> <span class="identifier">object</span><span class="special">.</span><span class="identifier">get</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
<span class="special">}</span>
</pre>
<p>
      <span class="bold"><strong>Compile</strong></span> :
    </p>
<pre class="programlisting"><span class="special">&gt;</span> <span class="identifier">gpp</span> <span class="identifier">my_cpp</span><span class="special">.</span><span class="identifier">cppm</span> <span class="special">-</span><span class="identifier">c</span> <span class="special">-</span><span class="identifier">fPIC</span> <span class="special">-</span><span class="identifier">shared</span> <span class="special">-</span><span class="identifier">o</span> <span class="identifier">libmy_cpp</span><span class="special">.</span><span class="identifier">so</span>
<span class="special">&gt;</span> <span class="identifier">gpp</span> <span class="identifier">main</span><span class="special">.</span><span class="identifier">cpp</span> <span class="special">-</span><span class="identifier">L</span><span class="special">./</span> <span class="special">-</span><span class="identifier">lmy_cpp</span> <span class="special">-</span><span class="identifier">o</span> <span class="identifier">main</span>
<span class="special">&gt;</span> <span class="special">./</span><span class="identifier">main</span>
<span class="identifier">get</span><span class="special">:</span> <span class="number">234</span>
</pre>
<h2>
<a name="day-25-special-cpp-modules-gcc.h3"></a>
      <span class="phrase"><a name="day-25-special-cpp-modules-gcc.module-partition"></a></span><a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.module-partition"><span class="cyan">Next: Module Partition</span></a>
    </h2>
<p>
      A module partition can be imported by module units of the same named module.
    </p>
<p>
      In this example, <span class="ddgreen"><span class="bold"><strong>:my_partition</strong></span></span>
      can be imported by <span class="ddgreen"><span class="bold"><strong>my_module</strong></span></span>,
      it can not be imported by other module.
    </p>
<p>
      <span class="bold"><strong>my_cpp_part.cppm</strong></span> :
    </p>
<pre class="programlisting"><span class="keyword">export</span> <span class="identifier">module</span> <span class="identifier">my_module</span><span class="special">:</span><span class="identifier">my_partition</span><span class="special">;</span>

<span class="keyword">export</span> <span class="keyword">namespace</span> <span class="identifier">my_space</span>
<span class="special">{</span>
	<span class="keyword">class</span> <span class="identifier">my_class_2</span>
	<span class="special">{</span>
	<span class="keyword">public</span><span class="special">:</span>
		<span class="keyword">int</span> <span class="identifier">get</span><span class="special">()</span> <span class="keyword">const</span>
		<span class="special">{</span>
			<span class="keyword">return</span> <span class="special">-</span><span class="number">112233</span><span class="special">;</span>
		<span class="special">}</span>
	<span class="special">};</span>
<span class="special">}</span>
</pre>
<p>
      <span class="bold"><strong>my_cpp.cppm</strong></span> :
    </p>
<pre class="programlisting"><span class="keyword">export</span> <span class="identifier">module</span> <span class="identifier">my_module</span><span class="special">;</span>

<span class="keyword">export</span> <span class="identifier">import</span> <span class="special">:</span><span class="identifier">my_partition</span><span class="special">;</span>

<span class="keyword">export</span> <span class="keyword">namespace</span> <span class="identifier">my_space</span>
<span class="special">{</span>
	<span class="keyword">class</span> <span class="identifier">my_class</span>
	<span class="special">{</span>
	<span class="keyword">public</span><span class="special">:</span>
		<span class="keyword">int</span> <span class="identifier">get</span><span class="special">()</span> <span class="keyword">const</span>
		<span class="special">{</span>
			<span class="keyword">return</span> <span class="number">3333</span><span class="special">;</span>
		<span class="special">}</span>
	<span class="special">};</span>
<span class="special">}</span>
</pre>
<p>
      <span class="bold"><strong>main.cpp</strong></span> :
    </p>
<pre class="programlisting"><span class="identifier">import</span> <span class="identifier">my_module</span><span class="special">;</span>
<span class="identifier">import</span> <span class="identifier">std</span><span class="special">;</span>

<span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span>
<span class="special">{</span>
	<span class="identifier">my_space</span><span class="special">::</span><span class="identifier">my_class</span> <span class="identifier">obj1</span><span class="special">;</span>
	<span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"v: "</span> <span class="special">&lt;&lt;</span> <span class="identifier">obj1</span><span class="special">.</span><span class="identifier">get</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
	<span class="identifier">my_space</span><span class="special">::</span><span class="identifier">my_class_2</span> <span class="identifier">obj2</span><span class="special">;</span>
	<span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"v: "</span> <span class="special">&lt;&lt;</span> <span class="identifier">obj2</span><span class="special">.</span><span class="identifier">get</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
<span class="special">}</span>
</pre>
<p>
      <span class="bold"><strong>Compile</strong></span> :
    </p>
<p>
      (compile order is important, my_cpp.cppm depends on my_cpp_part.cppm)
    </p>
<pre class="programlisting"><span class="special">&gt;</span> <span class="identifier">gpp</span> <span class="identifier">my_cpp_part</span><span class="special">.</span><span class="identifier">cppm</span> <span class="identifier">my_cpp</span><span class="special">.</span><span class="identifier">cppm</span> <span class="special">-</span><span class="identifier">c</span> <span class="special">-</span><span class="identifier">fPIC</span>
<span class="special">&gt;</span> <span class="identifier">gpp</span> <span class="special">*.</span><span class="identifier">o</span> <span class="special">-</span><span class="identifier">shared</span> <span class="special">-</span><span class="identifier">o</span> <span class="identifier">libmy_cpp</span><span class="special">.</span><span class="identifier">so</span>
<span class="special">&gt;</span> <span class="identifier">gpp</span> <span class="identifier">main</span><span class="special">.</span><span class="identifier">cpp</span> <span class="special">-</span><span class="identifier">L</span><span class="special">./</span> <span class="special">-</span><span class="identifier">lmy_cpp</span> <span class="special">-</span><span class="identifier">o</span> <span class="identifier">main</span>
</pre>
<pre class="programlisting"><span class="special">&gt;</span> <span class="special">./</span><span class="identifier">main</span>
<span class="identifier">v</span><span class="special">:</span> <span class="number">3333</span>
<span class="identifier">v</span><span class="special">:</span> <span class="special">-</span><span class="number">112233</span>
</pre>
<h2>
<a name="day-25-special-cpp-modules-gcc.h4"></a>
      <span class="phrase"><a name="day-25-special-cpp-modules-gcc.header-unit"></a></span><a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.header-unit"><span class="cyan">Next: Header Unit</span></a>
    </h2>
<p>
      <span class="bold"><strong>First, precompile</strong></span> :
    </p>
<pre class="programlisting"><span class="special">&gt;</span> <span class="identifier">gpp</span> <span class="special">-</span><span class="identifier">xc</span><span class="special">++-</span><span class="identifier">system</span><span class="special">-</span><span class="identifier">header</span> <span class="identifier">boost</span><span class="special">/</span><span class="identifier">parser</span><span class="special">/</span><span class="identifier">parser</span><span class="special">.</span><span class="identifier">hpp</span>
<span class="special">&gt;</span> <span class="identifier">gpp</span> <span class="special">-</span><span class="identifier">xc</span><span class="special">++-</span><span class="identifier">system</span><span class="special">-</span><span class="identifier">header</span> <span class="identifier">iostream</span>
</pre>
<p>
      <span class="bold"><strong>Then, use</strong></span> :
    </p>
<p>
      (program.cpp :)
    </p>
<pre class="programlisting"><span class="identifier">import</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">parser</span><span class="special">/</span><span class="identifier">parser</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;;</span>
<span class="identifier">import</span> <span class="special">&lt;</span><span class="identifier">iostream</span><span class="special">&gt;;</span>

<span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span>
<span class="special">{</span>
	<span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"Hello, c++!"</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
<span class="special">}</span>
</pre>
<p>
      <span class="bold"><strong>Compile</strong></span> :
    </p>
<pre class="programlisting">&gt; gpp program.cpp -o program</pre>
<h2>
<a name="day-25-special-cpp-modules-gcc.h5"></a>
      <span class="phrase"><a name="day-25-special-cpp-modules-gcc.split-definitions"></a></span><a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.split-definitions"><span class="cyan">Next: Split Definitions for Shared Library (Module Unit and Module
      Implementation Unit)</span></a>
    </h2>
<p>
      A <span class="bold"><strong>module unit</strong></span> contains declaration :
    </p>
<p>
      <span class="dddred">export module my_module;</span>
    </p>
<p>
      A <span class="bold"><strong>module implementation unit</strong></span> is the implementation
      of module unit, which does not have <span class="bold"><strong>export</strong></span>
      keyword :
    </p>
<p>
      <span class="dddred">module my_module;</span>
    </p>
<p>
      <span class="bold"><strong>my_cpp.cppm</strong></span> : <span class="dddgreen">(module
      unit)</span>
    </p>
<pre class="programlisting"><span class="keyword">export</span> <span class="identifier">module</span> <span class="identifier">my_module</span><span class="special">;</span>
<span class="keyword">export</span> <span class="keyword">namespace</span> <span class="identifier">my_space</span>
<span class="special">{</span>
	<span class="keyword">class</span> <span class="identifier">my_class</span>
	<span class="special">{</span>
	<span class="keyword">public</span><span class="special">:</span>
		<span class="keyword">void</span> <span class="identifier">greeting</span><span class="special">()</span> <span class="keyword">const</span><span class="special">;</span>
		<span class="keyword">void</span> <span class="identifier">cheers</span><span class="special">()</span> <span class="keyword">const</span><span class="special">;</span>
		<span class="keyword">int</span> <span class="identifier">get</span><span class="special">()</span> <span class="keyword">const</span><span class="special">;</span>
		<span class="keyword">virtual</span> <span class="special">~</span><span class="identifier">my_class</span><span class="special">();</span>
	<span class="special">};</span>
<span class="special">}</span>
</pre>
<p>
      <span class="bold"><strong>my_cpp_src.cppm</strong></span> : <span class="dddgreen">(module
      implementation unit)</span>
    </p>
<pre class="programlisting"><span class="identifier">module</span> <span class="identifier">my_module</span><span class="special">;</span>
<span class="identifier">import</span> <span class="identifier">std</span><span class="special">;</span>
<span class="identifier">my_space</span><span class="special">::</span><span class="identifier">my_class</span><span class="special">::~</span><span class="identifier">my_class</span><span class="special">()</span>
<span class="special">{</span>
	<span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"Bye, c++!"</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
<span class="special">}</span>
<span class="keyword">void</span> <span class="identifier">my_space</span><span class="special">::</span><span class="identifier">my_class</span><span class="special">::</span><span class="identifier">greeting</span><span class="special">()</span> <span class="keyword">const</span>
<span class="special">{</span>
	<span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"Greeting, c++!"</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
<span class="special">}</span>
<span class="keyword">void</span> <span class="identifier">my_space</span><span class="special">::</span><span class="identifier">my_class</span><span class="special">::</span><span class="identifier">cheers</span><span class="special">()</span> <span class="keyword">const</span>
<span class="special">{</span>
	<span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"Cheers, c++!"</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
<span class="special">}</span>
<span class="keyword">int</span> <span class="identifier">my_space</span><span class="special">::</span><span class="identifier">my_class</span><span class="special">::</span><span class="identifier">get</span><span class="special">()</span> <span class="keyword">const</span>
<span class="special">{</span>
	<span class="keyword">return</span> <span class="number">12345</span><span class="special">;</span>
<span class="special">}</span>
</pre>
<p>
      <span class="bold"><strong>main.cpp</strong></span> :
    </p>
<pre class="programlisting"><span class="identifier">import</span> <span class="identifier">my_module</span><span class="special">;</span>
<span class="identifier">import</span> <span class="identifier">std</span><span class="special">;</span>
<span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span>
<span class="special">{</span>
	<span class="identifier">my_space</span><span class="special">::</span><span class="identifier">my_class</span> <span class="identifier">my_object</span><span class="special">;</span>
	<span class="identifier">my_object</span><span class="special">.</span><span class="identifier">greeting</span><span class="special">();</span>
	<span class="identifier">my_object</span><span class="special">.</span><span class="identifier">cheers</span><span class="special">();</span>
	<span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"get: "</span> <span class="special">&lt;&lt;</span> <span class="identifier">my_object</span><span class="special">.</span><span class="identifier">get</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
<span class="special">}</span>
</pre>
<p>
      <span class="bold"><strong>Compile</strong></span> :
    </p>
<pre class="programlisting"><span class="special">&gt;</span> <span class="identifier">gpp</span> <span class="identifier">my_cpp</span><span class="special">.</span><span class="identifier">cppm</span> <span class="identifier">my_cpp_src</span><span class="special">.</span><span class="identifier">cppm</span> <span class="special">-</span><span class="identifier">c</span> <span class="special">-</span><span class="identifier">fPIC</span>
<span class="special">&gt;</span> <span class="identifier">gpp</span> <span class="identifier">my_cpp</span><span class="special">.</span><span class="identifier">o</span> <span class="identifier">my_cpp_src</span><span class="special">.</span><span class="identifier">o</span> <span class="special">-</span><span class="identifier">shared</span> <span class="special">-</span><span class="identifier">o</span> <span class="identifier">libmy_cpp</span><span class="special">.</span><span class="identifier">so</span>
<span class="special">&gt;</span> <span class="identifier">gpp</span> <span class="identifier">main</span><span class="special">.</span><span class="identifier">cpp</span> <span class="special">-</span><span class="identifier">L</span><span class="special">./</span> <span class="special">-</span><span class="identifier">lmy_cpp</span> <span class="special">-</span><span class="identifier">o</span> <span class="identifier">main</span>
</pre>
<pre class="programlisting"><span class="special">&gt;</span> <span class="special">./</span><span class="identifier">main</span>
<span class="identifier">Greeting</span><span class="special">,</span> <span class="identifier">c</span><span class="special">++!</span>
<span class="identifier">Cheers</span><span class="special">,</span> <span class="identifier">c</span><span class="special">++!</span>
<span class="identifier">get</span><span class="special">:</span> <span class="number">12345</span>
<span class="identifier">Bye</span><span class="special">,</span> <span class="identifier">c</span><span class="special">++!</span>
</pre>
<h3>
<a name="day-25-special-cpp-modules-gcc.h6"></a>
      <span class="phrase"><a name="day-25-special-cpp-modules-gcc.about-module-declaration"></a></span><a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.about-module-declaration">About Module
      Declaration</a>
    </h3>
<p>
      <span class="bold"><strong>Declare Primary Module Unit</strong></span>
    </p>
<p>
      (Name is A)
    </p>
<pre class="programlisting"><span class="keyword">export</span> <span class="identifier">module</span> <span class="identifier">A</span><span class="special">;</span>
</pre>
<p>
      (Name is A.B)
    </p>
<pre class="programlisting"><span class="keyword">export</span> <span class="identifier">module</span> <span class="identifier">A</span><span class="special">.</span><span class="identifier">B</span><span class="special">;</span>
</pre>
<p>
      <span class="bold"><strong>Declare Module Implementation Unit</strong></span>
    </p>
<pre class="programlisting"><span class="identifier">module</span> <span class="identifier">A</span><span class="special">;</span>
</pre>
<pre class="programlisting"><span class="identifier">module</span> <span class="identifier">A</span><span class="special">.</span><span class="identifier">B</span><span class="special">;</span>
</pre>
<h3>
<a name="day-25-special-cpp-modules-gcc.h7"></a>
      <span class="phrase"><a name="day-25-special-cpp-modules-gcc.constexpr-template"></a></span><a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.constexpr-template">constexpr
      and template</a>
    </h3>
<p>
      constexpr and template declared api can not be splitted into two declaration
      and definition module files.
    </p>
<h2>
<a name="day-25-special-cpp-modules-gcc.h8"></a>
      <span class="phrase"><a name="day-25-special-cpp-modules-gcc.modules-in-b2-build"></a></span><a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.modules-in-b2-build"><span class="cyan">Next: c++ Modules in B2 Build System</span></a>
    </h2>
<p>
      c++ modules gcc can be used in b2 build by flags settings trick.
    </p>
<h3>
<a name="day-25-special-cpp-modules-gcc.h9"></a>
      <span class="phrase"><a name="day-25-special-cpp-modules-gcc.first"></a></span><a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.first">First:
      About import std;</a>
    </h3>
<p>
      First, generate <span class="bold"><strong><span class="ddgreen">gcm.cache/std.gcm</span></strong></span>
      cache in current working directory like talked in the beginning of this article,
      I am a little lazy of how to make it by a b2 jamfile trick.
    </p>
<h3>
<a name="day-25-special-cpp-modules-gcc.h10"></a>
      <span class="phrase"><a name="day-25-special-cpp-modules-gcc.cpp-src"></a></span><a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.cpp-src">c++
      source files</a>
    </h3>
<p>
      The same c++ source files of previous section of this article will be used
      for this project:
    </p>
<p>
      (<a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.split-definitions">Split Definitions
      for Shared Library</a>)
    </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
          my_cpp.cppm
        </li>
<li class="listitem">
          my_cpp_src.cppm
        </li>
<li class="listitem">
          main.cpp
        </li>
</ul></div>
<p>
      (Because b2 build does not support .cppm file name extension by default (which
      needs a simple patch), we have to rename them):
    </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
          my_cpp.cppm -&gt; mycpp.cpp
        </li>
<li class="listitem">
          my_cpp_src.cppm -&gt; my_cpp_src.cpp
        </li>
<li class="listitem">
          main.cpp
        </li>
</ul></div>
<h3>
<a name="day-25-special-cpp-modules-gcc.h11"></a>
      <span class="phrase"><a name="day-25-special-cpp-modules-gcc.jamroot"></a></span><a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.jamroot">File:
      jamroot</a>
    </h3>
<p>
      The file jamroot in current working directory:
    </p>
<p>
      <span class="bold"><strong>jamroot</strong></span> :
    </p>
<pre class="programlisting"><span class="identifier">project</span> <span class="special">:</span> <span class="identifier">requirements</span> <span class="special">&lt;</span><span class="identifier">cxxflags</span><span class="special">&gt;</span><span class="string">"-fmodules-ts"</span> <span class="special">:</span> <span class="keyword">default</span><span class="special">-</span><span class="identifier">build</span> <span class="special">&lt;</span><span class="identifier">cxxstd</span><span class="special">&gt;</span><span class="number">26</span> <span class="special">;</span>
<span class="identifier">obj</span> <span class="identifier">obj</span><span class="special">-</span><span class="identifier">my_cpp</span> <span class="special">:</span> <span class="identifier">my_cpp</span><span class="special">.</span><span class="identifier">cpp</span> <span class="special">;</span>
<span class="identifier">obj</span> <span class="identifier">obj</span><span class="special">-</span><span class="identifier">my_cpp_src</span> <span class="special">:</span> <span class="identifier">my_cpp_src</span><span class="special">.</span><span class="identifier">cpp</span> <span class="special">:</span> <span class="special">&lt;</span><span class="identifier">dependency</span><span class="special">&gt;</span><span class="identifier">obj</span><span class="special">-</span><span class="identifier">my_cpp</span> <span class="special">;</span>
<span class="identifier">lib</span> <span class="identifier">my_cpp</span> <span class="special">:</span> <span class="identifier">obj</span><span class="special">-</span><span class="identifier">my_cpp</span> <span class="identifier">obj</span><span class="special">-</span><span class="identifier">my_cpp_src</span> <span class="special">;</span>
<span class="identifier">exe</span> <span class="identifier">main</span> <span class="special">:</span> <span class="identifier">main</span><span class="special">.</span><span class="identifier">cpp</span> <span class="special">:</span> <span class="special">&lt;</span><span class="identifier">library</span><span class="special">&gt;</span><span class="identifier">my_cpp</span> <span class="special">&lt;</span><span class="identifier">dependency</span><span class="special">&gt;</span><span class="identifier">my_cpp</span> <span class="special">;</span>
</pre>
<h3>
<a name="day-25-special-cpp-modules-gcc.h12"></a>
      <span class="phrase"><a name="day-25-special-cpp-modules-gcc.build-project"></a></span><a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.build-project">Build
      the project</a>
    </h3>
<p>
      (Requires toolset gcc version &gt;= 15.2. I use 16.0)
    </p>
<p>
      <span class="bold"><strong>Build:</strong></span>
    </p>
<pre class="programlisting"><span class="special">&gt;</span> <span class="identifier">b2</span> <span class="special">-</span><span class="identifier">q</span> <span class="special">-</span><span class="identifier">j7</span>
</pre>
<p>
      Make sure the toolset used for this project is gcc. Visual c++ and clang++
      has different compiler flags.
    </p>
<p>
      <span class="bold"><strong>Run program:</strong></span>
    </p>
<pre class="programlisting"><span class="special">&gt;</span> <span class="identifier">ls</span> <span class="special">./</span><span class="identifier">bin</span><span class="special">/</span><span class="identifier">gcc</span><span class="special">-</span><span class="identifier">latest</span><span class="special">/</span><span class="identifier">debug</span><span class="special">/</span><span class="identifier">cxxstd</span><span class="special">-</span><span class="number">26</span><span class="special">-</span><span class="identifier">iso</span><span class="special">/</span>
<span class="identifier">libmy_cpp</span><span class="special">.</span><span class="identifier">so</span>  <span class="identifier">main</span>  <span class="identifier">main</span><span class="special">.</span><span class="identifier">o</span>  <span class="identifier">my_cpp</span><span class="special">.</span><span class="identifier">o</span>  <span class="identifier">my_cpp_src</span><span class="special">.</span><span class="identifier">o</span>
<span class="special">&gt;</span>
<span class="special">&gt;</span>
<span class="special">&gt;</span>
<span class="special">&gt;</span> <span class="special">./</span><span class="identifier">bin</span><span class="special">/</span><span class="identifier">gcc</span><span class="special">-</span><span class="identifier">latest</span><span class="special">/</span><span class="identifier">debug</span><span class="special">/</span><span class="identifier">cxxstd</span><span class="special">-</span><span class="number">26</span><span class="special">-</span><span class="identifier">iso</span><span class="special">/</span><span class="identifier">main</span>
<span class="identifier">Greeting</span><span class="special">,</span> <span class="identifier">c</span><span class="special">++!</span>
<span class="identifier">Cheers</span><span class="special">,</span> <span class="identifier">c</span><span class="special">++!</span>
<span class="identifier">get</span><span class="special">:</span> <span class="number">12345</span>
<span class="identifier">Bye</span><span class="special">,</span> <span class="identifier">c</span><span class="special">++!</span>
</pre>
<h2>
<a name="day-25-special-cpp-modules-gcc.h13"></a>
      <span class="phrase"><a name="day-25-special-cpp-modules-gcc.glossary"></a></span><a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.glossary"><span class="cyan">Last: Glossary</span></a>
    </h2>
<h3>
<a name="day-25-special-cpp-modules-gcc.h14"></a>
      <span class="phrase"><a name="day-25-special-cpp-modules-gcc.module-declaration"></a></span><a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.module-declaration">Module
      Declaration</a>
    </h3>
<p>
      ...
    </p>
<h3>
<a name="day-25-special-cpp-modules-gcc.h15"></a>
      <span class="phrase"><a name="day-25-special-cpp-modules-gcc.module-definition"></a></span><a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.module-definition">Module
      definition</a>
    </h3>
<p>
      ...
    </p>
<h3>
<a name="day-25-special-cpp-modules-gcc.h16"></a>
      <span class="phrase"><a name="day-25-special-cpp-modules-gcc.export-declaration"></a></span><a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.export-declaration">Export
      Declaration</a>
    </h3>
<p>
      ...
    </p>
<h3>
<a name="day-25-special-cpp-modules-gcc.h17"></a>
      <span class="phrase"><a name="day-25-special-cpp-modules-gcc.import-declaration"></a></span><a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.import-declaration">Import
      Declaration</a>
    </h3>
<p>
      ...
    </p>
<h3>
<a name="day-25-special-cpp-modules-gcc.h18"></a>
      <span class="phrase"><a name="day-25-special-cpp-modules-gcc.translation-unit"></a></span><a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.translation-unit">Translation
      Unit</a>
    </h3>
<p>
      ...
    </p>
<h3>
<a name="day-25-special-cpp-modules-gcc.h19"></a>
      <span class="phrase"><a name="day-25-special-cpp-modules-gcc.module-unit"></a></span><a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.module-unit">Module
      Unit</a>
    </h3>
<p>
      A module unit is a translation unit which has a module declaration.
    </p>
<h3>
<a name="day-25-special-cpp-modules-gcc.h20"></a>
      <span class="phrase"><a name="day-25-special-cpp-modules-gcc.module-partition-unit"></a></span><a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.module-partition-unit">Module
      Partition Unit</a>
    </h3>
<p>
      A module partition unit is a module unit which is included by a module unit
      and starts with a colon <span class="bold"><strong><span class="red">:</span></strong></span>
      , and is placed after the module name.
    </p>
<p>
      <span class="bold"><strong>For example</strong></span>,
    </p>
<pre class="programlisting"><span class="keyword">export</span> <span class="identifier">module</span> <span class="identifier">A</span><span class="special">:</span><span class="identifier">B</span><span class="special">;</span>
</pre>
<pre class="programlisting"><span class="keyword">export</span> <span class="identifier">module</span> <span class="identifier">A</span><span class="special">;</span>
</pre>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
          A is a module unit,
        </li>
<li class="listitem">
          :B is a module partition unit.
        </li>
</ul></div>
<h3>
<a name="day-25-special-cpp-modules-gcc.h21"></a>
      <span class="phrase"><a name="day-25-special-cpp-modules-gcc.module-name"></a></span><a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.module-name">Module
      Name</a>
    </h3>
<p>
      Module name is the name of the module unit, which consists of one or more identifiers
      separated by dots. Note that module partition unit is also module unit.
    </p>
<p>
      <span class="bold"><strong>For example</strong></span>,
    </p>
<pre class="programlisting"><span class="comment">// Module name is A</span>
<span class="keyword">export</span> <span class="identifier">module</span> <span class="identifier">A</span><span class="special">;</span>
</pre>
<pre class="programlisting"><span class="comment">// Module name is A.B.C</span>
<span class="keyword">export</span> <span class="identifier">module</span> <span class="identifier">A</span><span class="special">.</span><span class="identifier">B</span><span class="special">.</span><span class="identifier">C</span><span class="special">;</span>
</pre>
<h2>
<a name="day-25-special-cpp-modules-gcc.h22"></a>
      <span class="phrase"><a name="day-25-special-cpp-modules-gcc.date"></a></span><a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.date"><span class="cyan">Date</span></a>
    </h2>
<p>
      <em class="replaceable"><code>Written on Apr 24, 2025</code></em>
    </p>
<h2>
<a name="day-25-special-cpp-modules-gcc.h23"></a>
      <span class="phrase"><a name="day-25-special-cpp-modules-gcc.back"></a></span><a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.back"><span class="cyan">Back to index</span></a>
    </h2>
<p>
      <a href="." target="_top">Index</a>
    </p>
<h2>
<a name="day-25-special-cpp-modules-gcc.h24"></a>
      <span class="phrase"><a name="day-25-special-cpp-modules-gcc.cpp-lang"></a></span><a class="link" href="day-25-special-cpp-modules-gcc.html#day-25-special-cpp-modules-gcc.cpp-lang"><span class="cyan">cpp/c++</span></a>
    </h2>
<p>
      c++ std::exception:
    </p>
<p>
      std::cout.write(err.data(), err.size());
    </p>
<p>
      std::cout &lt;&lt; std::endl;
    </p>
<p>
      <span class="purple">caught:</span>
    </p>
<pre class="programlisting">  ===================================
  #  The c++ programming language.  #
  #                                 #
  #  Join c++                       #
  #  Deck                           #
  ===================================
</pre>
<p>
      <a href="https://cppfx.xyz" target="_top">Home: cppfx.xyz</a>
    </p>
</div>
<div class="copyright-footer"></div>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="day-24-cpp-stl-std-copy-std-fill.html"><img src="images/prev.png" alt="Prev"></a><a accesskey="u" href="index.html"><img src="images/up.png" alt="Up"></a><a accesskey="h" href="index.html"><img src="images/home.png" alt="Home"></a>
</div>
</body>
</html>
