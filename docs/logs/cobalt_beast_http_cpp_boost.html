<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>cobalt beast http - cpp boost</title>
<link rel="stylesheet" href="boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets Vsnapshot">
<link rel="home" href="index.html" title="logs - Blogs or News">
<link rel="up" href="index.html" title="logs - Blogs or News">
<link rel="prev" href="cobalt_main_entry_points_cpp_boo.html" title="cobalt main entry points - cpp boost">
<link rel="next" href="cobalt_op_what_is_it_cpp_boost.html" title="cobalt op, what is it ? - cpp boost">
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="spirit-nav">
<a accesskey="p" href="cobalt_main_entry_points_cpp_boo.html"><img src="images/prev.png" alt="Prev"></a><a accesskey="u" href="index.html"><img src="images/up.png" alt="Up"></a><a accesskey="h" href="index.html"><img src="images/home.png" alt="Home"></a><a accesskey="n" href="cobalt_op_what_is_it_cpp_boost.html"><img src="images/next.png" alt="Next"></a>
</div>
<div class="article">
<div class="titlepage">
<div><div><h1 class="title">
<a name="cobalt_beast_http_cpp_boost"></a>cobalt beast http - cpp boost</h1></div></div>
<hr>
</div>
<p>
      cobalt beast http server/client - Posted on Apr 18, 2024 - See <a href="https://www.boost.org/libs/cobalt" target="_top">https://www.boost.org/libs/cobalt</a>
      - <a href="https://cppfx.xyz/logs" target="_top">Logs Home</a> - d0015
    </p>
<h2>
<a name="cobalt_beast_http_cpp_boost.h0"></a>
      <span class="phrase"><a name="cobalt_beast_http_cpp_boost.role_cyan_cobalt_beast_http_serv"></a></span><a class="link" href="cobalt_beast_http_cpp_boost.html#cobalt_beast_http_cpp_boost.role_cyan_cobalt_beast_http_serv"><span class="cyan">cobalt beast http server/client - cpp boost</span></a>
    </h2>
<p>
      cobalt beast http server/client - c++ boost
    </p>
<p>
      keys:
    </p>
<p>
      cobalt::use_op
    </p>
<p>
      cobalt::this_thread::get_executor()
    </p>
<p>
      cobalt::promise
    </p>
<p>
      co_await
    </p>
<p>
      co_return
    </p>
<h2>
<a name="cobalt_beast_http_cpp_boost.h1"></a>
      <span class="phrase"><a name="cobalt_beast_http_cpp_boost.role_cyan_cpp_program"></a></span><a class="link" href="cobalt_beast_http_cpp_boost.html#cobalt_beast_http_cpp_boost.role_cyan_cpp_program"><span class="cyan">cpp program</span></a>
    </h2>
<p>
      c++ program, boost::cobalt boost::beast http server/client
    </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">cobalt</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">process</span><span class="special">/</span><span class="identifier">v2</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">iostream</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">asio</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">beast</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">chrono</span><span class="special">&gt;</span>

<span class="keyword">namespace</span> <span class="identifier">cobalt</span> <span class="special">=</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">cobalt</span><span class="special">;</span>
<span class="keyword">namespace</span> <span class="identifier">process</span> <span class="special">=</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">process</span><span class="special">::</span><span class="identifier">v2</span><span class="special">;</span>
<span class="keyword">namespace</span> <span class="identifier">asio</span> <span class="special">=</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">asio</span><span class="special">;</span>
<span class="keyword">namespace</span> <span class="identifier">beast</span> <span class="special">=</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">beast</span><span class="special">;</span>
<span class="keyword">namespace</span> <span class="identifier">http</span> <span class="special">=</span> <span class="identifier">beast</span><span class="special">::</span><span class="identifier">http</span><span class="special">;</span>
<span class="keyword">using</span> <span class="identifier">asio</span><span class="special">::</span><span class="identifier">ip</span><span class="special">::</span><span class="identifier">tcp</span><span class="special">;</span>

<span class="keyword">namespace</span> <span class="identifier">cpp</span>
<span class="special">{</span>
	<span class="keyword">using</span> <span class="identifier">uint16</span> <span class="special">=</span> <span class="keyword">unsigned</span> <span class="keyword">short</span><span class="special">;</span>
	<span class="keyword">using</span> <span class="identifier">uint64</span> <span class="special">=</span> <span class="keyword">unsigned</span> <span class="keyword">long</span><span class="special">;</span>
<span class="special">}</span>

<span class="keyword">namespace</span> <span class="identifier">api</span><span class="special">::</span><span class="identifier">server</span>
<span class="special">{</span>

<span class="keyword">class</span> <span class="identifier">http_server_session</span><span class="special">:</span> <span class="keyword">virtual</span> <span class="keyword">public</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">enable_shared_from_this</span><span class="special">&lt;</span><span class="identifier">api</span><span class="special">::</span><span class="identifier">server</span><span class="special">::</span><span class="identifier">http_server_session</span><span class="special">&gt;</span>
<span class="special">{</span>
<span class="keyword">protected</span><span class="special">:</span>
	<span class="identifier">http</span><span class="special">::</span><span class="identifier">request</span><span class="special">&lt;</span><span class="identifier">http</span><span class="special">::</span><span class="identifier">string_body</span><span class="special">&gt;</span> <span class="identifier">request</span><span class="special">;</span>
	<span class="identifier">http</span><span class="special">::</span><span class="identifier">response</span><span class="special">&lt;</span><span class="identifier">http</span><span class="special">::</span><span class="identifier">string_body</span><span class="special">&gt;</span> <span class="identifier">response</span><span class="special">;</span>
	<span class="identifier">beast</span><span class="special">::</span><span class="identifier">flat_buffer</span> <span class="identifier">buffer</span><span class="special">;</span>
	<span class="identifier">beast</span><span class="special">::</span><span class="identifier">tcp_stream</span> <span class="identifier">stream</span><span class="special">;</span>
<span class="keyword">public</span><span class="special">:</span>
	<span class="keyword">virtual</span> <span class="special">~</span><span class="identifier">http_server_session</span><span class="special">()</span> <span class="special">=</span> <span class="keyword">default</span><span class="special">;</span>
<span class="keyword">public</span><span class="special">:</span>
	<span class="identifier">http_server_session</span><span class="special">(</span><span class="identifier">tcp</span><span class="special">::</span><span class="identifier">socket</span> <span class="special">&amp;&amp;</span> <span class="identifier">socket</span><span class="special">):</span>
		<span class="identifier">stream</span><span class="special">{</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">move</span><span class="special">(</span><span class="identifier">socket</span><span class="special">)}</span>
	<span class="special">{</span>
	<span class="special">}</span>
<span class="keyword">public</span><span class="special">:</span>
	<span class="identifier">cobalt</span><span class="special">::</span><span class="identifier">promise</span><span class="special">&lt;</span><span class="keyword">void</span><span class="special">&gt;</span> <span class="identifier">run</span><span class="special">()</span>
	<span class="special">{</span>
		<span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"server said: a session is created.\n"</span><span class="special">;</span>
		<span class="identifier">co_await</span> <span class="keyword">this</span><span class="special">-&gt;</span><span class="identifier">read_write</span><span class="special">();</span>
		<span class="identifier">co_await</span> <span class="keyword">this</span><span class="special">-&gt;</span><span class="identifier">close_session</span><span class="special">();</span>
	<span class="special">}</span>
	<span class="identifier">cobalt</span><span class="special">::</span><span class="identifier">promise</span><span class="special">&lt;</span><span class="keyword">void</span><span class="special">&gt;</span> <span class="identifier">read_write</span><span class="special">()</span>
	<span class="special">{</span>
		<span class="identifier">response</span><span class="special">.</span><span class="identifier">set</span><span class="special">(</span><span class="identifier">http</span><span class="special">::</span><span class="identifier">field</span><span class="special">::</span><span class="identifier">content_type</span><span class="special">,</span> <span class="string">"text/html"</span><span class="special">);</span>
		<span class="identifier">response</span><span class="special">.</span><span class="identifier">body</span><span class="special">()</span> <span class="special">=</span> <span class="string">"&lt;html&gt;&lt;head&gt;&lt;title&gt;c++&lt;/title&gt;&lt;/head&gt;&lt;body&gt;Hello c++!&lt;/body&gt;&lt;/html&gt;"</span><span class="special">;</span>

		<span class="identifier">cpp</span><span class="special">::</span><span class="identifier">uint64</span> <span class="identifier">bytes</span> <span class="special">=</span> <span class="identifier">co_await</span> <span class="identifier">http</span><span class="special">::</span><span class="identifier">async_read</span><span class="special">(</span><span class="identifier">stream</span><span class="special">,</span> <span class="identifier">buffer</span><span class="special">,</span> <span class="identifier">request</span><span class="special">,</span> <span class="identifier">cobalt</span><span class="special">::</span><span class="identifier">use_op</span><span class="special">);</span>
		<span class="identifier">bytes</span> <span class="special">=</span> <span class="identifier">co_await</span> <span class="identifier">http</span><span class="special">::</span><span class="identifier">async_write</span><span class="special">(</span><span class="identifier">stream</span><span class="special">,</span> <span class="identifier">response</span><span class="special">,</span> <span class="identifier">cobalt</span><span class="special">::</span><span class="identifier">use_op</span><span class="special">);</span>
	<span class="special">}</span>
	<span class="identifier">cobalt</span><span class="special">::</span><span class="identifier">promise</span><span class="special">&lt;</span><span class="keyword">void</span><span class="special">&gt;</span> <span class="identifier">close_session</span><span class="special">()</span>
	<span class="special">{</span>
		<span class="identifier">stream</span><span class="special">.</span><span class="identifier">close</span><span class="special">();</span>
		<span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"server said: session is closed."</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
		<span class="identifier">co_return</span><span class="special">;</span>
	<span class="special">}</span>
<span class="special">};</span>

<span class="keyword">class</span> <span class="identifier">http_server</span><span class="special">:</span> <span class="keyword">virtual</span> <span class="keyword">public</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">enable_shared_from_this</span><span class="special">&lt;</span><span class="identifier">api</span><span class="special">::</span><span class="identifier">server</span><span class="special">::</span><span class="identifier">http_server</span><span class="special">&gt;</span>
<span class="special">{</span>
<span class="keyword">protected</span><span class="special">:</span>
	<span class="keyword">const</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span> <span class="identifier">ip</span><span class="special">;</span>
	<span class="identifier">cpp</span><span class="special">::</span><span class="identifier">uint16</span> <span class="identifier">port</span><span class="special">;</span>
	<span class="identifier">tcp</span><span class="special">::</span><span class="identifier">acceptor</span> <span class="identifier">acceptor</span><span class="special">;</span>
<span class="keyword">public</span><span class="special">:</span>
	<span class="keyword">virtual</span> <span class="special">~</span><span class="identifier">http_server</span><span class="special">()</span> <span class="special">=</span> <span class="keyword">default</span><span class="special">;</span>
<span class="keyword">public</span><span class="special">:</span>
	<span class="identifier">http_server</span><span class="special">(</span><span class="keyword">const</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string_view</span> <span class="identifier">ip__</span><span class="special">,</span> <span class="identifier">cpp</span><span class="special">::</span><span class="identifier">uint16</span> <span class="identifier">port__</span><span class="special">):</span>
		<span class="identifier">ip</span><span class="special">{</span><span class="identifier">ip__</span><span class="special">},</span>
		<span class="identifier">port</span><span class="special">{</span><span class="identifier">port__</span><span class="special">},</span>
		<span class="identifier">acceptor</span><span class="special">{</span>
			<span class="identifier">cobalt</span><span class="special">::</span><span class="identifier">this_thread</span><span class="special">::</span><span class="identifier">get_executor</span><span class="special">(),</span>
			<span class="identifier">tcp</span><span class="special">::</span><span class="identifier">endpoint</span><span class="special">{</span><span class="identifier">asio</span><span class="special">::</span><span class="identifier">ip</span><span class="special">::</span><span class="identifier">make_address</span><span class="special">(</span><span class="identifier">ip</span><span class="special">),</span> <span class="identifier">port</span><span class="special">}</span>
		<span class="special">}</span>
	<span class="special">{</span>
	<span class="special">}</span>
<span class="keyword">public</span><span class="special">:</span>
	<span class="identifier">cobalt</span><span class="special">::</span><span class="identifier">promise</span><span class="special">&lt;</span><span class="keyword">void</span><span class="special">&gt;</span> <span class="identifier">run</span><span class="special">()</span>
	<span class="special">{</span>
		<span class="identifier">co_await</span> <span class="keyword">this</span><span class="special">-&gt;</span><span class="identifier">accept</span><span class="special">();</span>
	<span class="special">}</span>
	<span class="identifier">cobalt</span><span class="special">::</span><span class="identifier">promise</span><span class="special">&lt;</span><span class="keyword">void</span><span class="special">&gt;</span> <span class="identifier">accept</span><span class="special">()</span>
	<span class="special">{</span>
		<span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"\n\nHttp server is listening on "</span> <span class="special">&lt;&lt;</span> <span class="identifier">ip</span> <span class="special">&lt;&lt;</span> <span class="string">" "</span> <span class="special">&lt;&lt;</span> <span class="identifier">port</span> <span class="special">&lt;&lt;</span> <span class="string">" ...."</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
		<span class="identifier">tcp</span><span class="special">::</span><span class="identifier">socket</span> <span class="identifier">socket</span> <span class="special">=</span> <span class="identifier">co_await</span> <span class="identifier">acceptor</span><span class="special">.</span><span class="identifier">async_accept</span><span class="special">(</span><span class="identifier">cobalt</span><span class="special">::</span><span class="identifier">use_op</span><span class="special">);</span>
		<span class="identifier">co_await</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">make_shared</span><span class="special">&lt;</span><span class="identifier">api</span><span class="special">::</span><span class="identifier">server</span><span class="special">::</span><span class="identifier">http_server_session</span><span class="special">&gt;(</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">move</span><span class="special">(</span><span class="identifier">socket</span><span class="special">))-&gt;</span><span class="identifier">run</span><span class="special">();</span>
		<span class="identifier">co_await</span> <span class="keyword">this</span><span class="special">-&gt;</span><span class="identifier">accept</span><span class="special">();</span>
	<span class="special">}</span>
<span class="special">};</span>	<span class="comment">// class http_server</span>

<span class="special">}</span>	<span class="comment">// namespace api::server</span>

<span class="keyword">namespace</span> <span class="identifier">api</span><span class="special">::</span><span class="identifier">client</span>
<span class="special">{</span>

<span class="keyword">class</span> <span class="identifier">http_client_session</span><span class="special">:</span> <span class="keyword">virtual</span> <span class="keyword">public</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">enable_shared_from_this</span><span class="special">&lt;</span><span class="identifier">api</span><span class="special">::</span><span class="identifier">client</span><span class="special">::</span><span class="identifier">http_client_session</span><span class="special">&gt;</span>
<span class="special">{</span>
<span class="keyword">protected</span><span class="special">:</span>
	<span class="keyword">const</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span> <span class="identifier">host</span><span class="special">;</span>
	<span class="keyword">const</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span> <span class="identifier">protocol</span><span class="special">;</span>

	<span class="identifier">tcp</span><span class="special">::</span><span class="identifier">resolver</span> <span class="identifier">resolver</span><span class="special">;</span>
	<span class="identifier">beast</span><span class="special">::</span><span class="identifier">tcp_stream</span> <span class="identifier">stream</span><span class="special">;</span>

	<span class="identifier">http</span><span class="special">::</span><span class="identifier">request</span><span class="special">&lt;</span><span class="identifier">http</span><span class="special">::</span><span class="identifier">string_body</span><span class="special">&gt;</span> <span class="identifier">request</span><span class="special">;</span>
	<span class="identifier">http</span><span class="special">::</span><span class="identifier">response</span><span class="special">&lt;</span><span class="identifier">http</span><span class="special">::</span><span class="identifier">string_body</span><span class="special">&gt;</span> <span class="identifier">response</span><span class="special">;</span>
	<span class="identifier">beast</span><span class="special">::</span><span class="identifier">flat_buffer</span> <span class="identifier">buffer</span><span class="special">;</span>
<span class="keyword">public</span><span class="special">:</span>
	<span class="keyword">virtual</span> <span class="special">~</span><span class="identifier">http_client_session</span><span class="special">()</span> <span class="special">=</span> <span class="keyword">default</span><span class="special">;</span>

<span class="keyword">public</span><span class="special">:</span>
	<span class="identifier">http_client_session</span><span class="special">(</span><span class="keyword">const</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string_view</span> <span class="identifier">host__</span><span class="special">,</span> <span class="keyword">const</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string_view</span> <span class="identifier">protocol__</span><span class="special">):</span>
		<span class="identifier">host</span><span class="special">{</span><span class="identifier">host__</span><span class="special">},</span>
		<span class="identifier">protocol</span><span class="special">{</span><span class="identifier">protocol__</span><span class="special">},</span>
		<span class="identifier">resolver</span><span class="special">{</span><span class="identifier">cobalt</span><span class="special">::</span><span class="identifier">this_thread</span><span class="special">::</span><span class="identifier">get_executor</span><span class="special">()},</span>
		<span class="identifier">stream</span><span class="special">{</span><span class="identifier">cobalt</span><span class="special">::</span><span class="identifier">this_thread</span><span class="special">::</span><span class="identifier">get_executor</span><span class="special">()}</span>
	<span class="special">{</span>
	<span class="special">}</span>

<span class="keyword">public</span><span class="special">:</span>
	<span class="identifier">cobalt</span><span class="special">::</span><span class="identifier">promise</span><span class="special">&lt;</span><span class="keyword">void</span><span class="special">&gt;</span> <span class="identifier">run</span><span class="special">()</span>
	<span class="special">{</span>
		<span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"\n\nclient said: request server ..."</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
		<span class="identifier">co_await</span> <span class="keyword">this</span><span class="special">-&gt;</span><span class="identifier">connect</span><span class="special">();</span>
		<span class="identifier">co_await</span> <span class="keyword">this</span><span class="special">-&gt;</span><span class="identifier">write_read</span><span class="special">();</span>
	<span class="special">}</span>
	<span class="identifier">cobalt</span><span class="special">::</span><span class="identifier">promise</span><span class="special">&lt;</span><span class="keyword">void</span><span class="special">&gt;</span> <span class="identifier">connect</span><span class="special">()</span>
	<span class="special">{</span>
		<span class="identifier">tcp</span><span class="special">::</span><span class="identifier">resolver</span><span class="special">::</span><span class="identifier">results_type</span> <span class="identifier">results</span> <span class="special">=</span> <span class="identifier">co_await</span> <span class="identifier">resolver</span><span class="special">.</span><span class="identifier">async_resolve</span><span class="special">(</span><span class="identifier">host</span><span class="special">,</span> <span class="identifier">protocol</span><span class="special">,</span> <span class="identifier">cobalt</span><span class="special">::</span><span class="identifier">use_op</span><span class="special">);</span>
		<span class="identifier">tcp</span><span class="special">::</span><span class="identifier">endpoint</span> <span class="identifier">ep</span> <span class="special">=</span> <span class="identifier">co_await</span> <span class="identifier">stream</span><span class="special">.</span><span class="identifier">async_connect</span><span class="special">(</span><span class="identifier">results</span><span class="special">,</span> <span class="identifier">cobalt</span><span class="special">::</span><span class="identifier">use_op</span><span class="special">);</span>
	<span class="special">}</span>
	<span class="identifier">cobalt</span><span class="special">::</span><span class="identifier">promise</span><span class="special">&lt;</span><span class="keyword">void</span><span class="special">&gt;</span> <span class="identifier">write_read</span><span class="special">()</span>
	<span class="special">{</span>
		<span class="identifier">request</span><span class="special">.</span><span class="identifier">version</span><span class="special">(</span><span class="number">11</span><span class="special">);</span>
		<span class="identifier">request</span><span class="special">.</span><span class="identifier">target</span><span class="special">(</span><span class="string">"/"</span><span class="special">);</span>
		<span class="identifier">request</span><span class="special">.</span><span class="identifier">set</span><span class="special">(</span><span class="identifier">http</span><span class="special">::</span><span class="identifier">field</span><span class="special">::</span><span class="identifier">host</span><span class="special">,</span> <span class="identifier">host</span><span class="special">);</span>
		<span class="identifier">request</span><span class="special">.</span><span class="identifier">method</span><span class="special">(</span><span class="identifier">http</span><span class="special">::</span><span class="identifier">verb</span><span class="special">::</span><span class="identifier">get</span><span class="special">);</span>
		<span class="identifier">request</span><span class="special">.</span><span class="identifier">set</span><span class="special">(</span><span class="identifier">http</span><span class="special">::</span><span class="identifier">field</span><span class="special">::</span><span class="identifier">user_agent</span><span class="special">,</span> <span class="string">"boost::beast c++"</span><span class="special">);</span>
		<span class="identifier">cpp</span><span class="special">::</span><span class="identifier">uint64</span> <span class="identifier">bytes</span> <span class="special">=</span> <span class="identifier">co_await</span> <span class="identifier">http</span><span class="special">::</span><span class="identifier">async_write</span><span class="special">(</span><span class="identifier">stream</span><span class="special">,</span> <span class="identifier">request</span><span class="special">,</span> <span class="identifier">cobalt</span><span class="special">::</span><span class="identifier">use_op</span><span class="special">);</span>
		<span class="identifier">bytes</span> <span class="special">=</span> <span class="identifier">co_await</span> <span class="identifier">http</span><span class="special">::</span><span class="identifier">async_read</span><span class="special">(</span><span class="identifier">stream</span><span class="special">,</span> <span class="identifier">buffer</span><span class="special">,</span> <span class="identifier">response</span><span class="special">,</span> <span class="identifier">cobalt</span><span class="special">::</span><span class="identifier">use_op</span><span class="special">);</span>
		<span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"client said: Got:\n"</span> <span class="special">&lt;&lt;</span> <span class="identifier">response</span><span class="special">.</span><span class="identifier">body</span><span class="special">().</span><span class="identifier">data</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
	<span class="special">}</span>
<span class="special">};</span>

<span class="special">}</span>	<span class="comment">// namespace api::client</span>

<span class="identifier">cobalt</span><span class="special">::</span><span class="identifier">main</span> <span class="identifier">co_main</span><span class="special">(</span><span class="keyword">int</span> <span class="identifier">argc</span><span class="special">,</span> <span class="keyword">char</span> <span class="special">*</span> <span class="identifier">argv</span><span class="special">[])</span>
<span class="special">{</span>
	<span class="keyword">if</span> <span class="special">(</span><span class="identifier">argc</span> <span class="special">&gt;=</span> <span class="number">2</span> <span class="special">&amp;&amp;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">(</span><span class="string">"server"</span><span class="special">)</span> <span class="special">==</span> <span class="identifier">argv</span><span class="special">[</span><span class="number">1</span><span class="special">])</span>
	<span class="special">{</span>
		<span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"server program is running ...\n"</span><span class="special">;</span>

		<span class="keyword">const</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span> <span class="identifier">ip</span> <span class="special">=</span> <span class="string">"0.0.0.0"</span><span class="special">;</span>
		<span class="keyword">const</span> <span class="identifier">cpp</span><span class="special">::</span><span class="identifier">uint16</span> <span class="identifier">port</span> <span class="special">=</span> <span class="number">4567u</span><span class="special">;</span>

		<span class="identifier">co_await</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">make_shared</span><span class="special">&lt;</span><span class="identifier">api</span><span class="special">::</span><span class="identifier">server</span><span class="special">::</span><span class="identifier">http_server</span><span class="special">&gt;(</span><span class="identifier">ip</span><span class="special">,</span> <span class="identifier">port</span><span class="special">)-&gt;</span><span class="identifier">run</span><span class="special">();</span>
		<span class="identifier">co_return</span> <span class="number">0</span><span class="special">;</span>
	<span class="special">}</span>
	<span class="keyword">else</span> <span class="keyword">if</span> <span class="special">(</span><span class="identifier">argc</span> <span class="special">&gt;=</span><span class="number">2</span> <span class="special">&amp;&amp;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span><span class="special">(</span><span class="string">"client"</span><span class="special">)</span> <span class="special">==</span> <span class="identifier">argv</span><span class="special">[</span><span class="number">1</span><span class="special">])</span>
	<span class="special">{</span>
		<span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"client program is running ...\n"</span><span class="special">;</span>
		<span class="keyword">while</span> <span class="special">(</span><span class="keyword">true</span><span class="special">)</span>
		<span class="special">{</span>
			<span class="identifier">co_await</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">make_shared</span><span class="special">&lt;</span><span class="identifier">api</span><span class="special">::</span><span class="identifier">client</span><span class="special">::</span><span class="identifier">http_client_session</span><span class="special">&gt;(</span><span class="string">"localhost"</span><span class="special">,</span> <span class="string">"4567"</span><span class="special">)-&gt;</span><span class="identifier">run</span><span class="special">();</span>
			<span class="identifier">std</span><span class="special">::</span><span class="identifier">this_thread</span><span class="special">::</span><span class="identifier">sleep_for</span><span class="special">(</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">chrono</span><span class="special">::</span><span class="identifier">milliseconds</span><span class="special">(</span><span class="number">1500</span><span class="special">));</span>
			<span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"============================================================\n"</span><span class="special">;</span>
			<span class="identifier">std</span><span class="special">::</span><span class="identifier">this_thread</span><span class="special">::</span><span class="identifier">sleep_for</span><span class="special">(</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">chrono</span><span class="special">::</span><span class="identifier">milliseconds</span><span class="special">(</span><span class="number">50</span><span class="special">));</span>
		<span class="special">}</span>
		<span class="identifier">co_return</span> <span class="number">0</span><span class="special">;</span>
	<span class="special">}</span>
	<span class="keyword">else</span>
	<span class="special">{</span>
		<span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"start ...\n"</span><span class="special">;</span>
		<span class="identifier">asio</span><span class="special">::</span><span class="identifier">io_context</span> <span class="identifier">io_context</span><span class="special">;</span>
		<span class="identifier">process</span><span class="special">::</span><span class="identifier">process</span> <span class="identifier">proc_server</span><span class="special">{</span><span class="identifier">io_context</span><span class="special">,</span> <span class="identifier">argv</span><span class="special">[</span><span class="number">0</span><span class="special">],</span> <span class="special">{</span><span class="string">"server"</span><span class="special">}};</span>
		<span class="identifier">process</span><span class="special">::</span><span class="identifier">process</span> <span class="identifier">proc_client</span><span class="special">{</span><span class="identifier">io_context</span><span class="special">,</span> <span class="identifier">argv</span><span class="special">[</span><span class="number">0</span><span class="special">],</span> <span class="special">{</span><span class="string">"client"</span><span class="special">}};</span>
		<span class="identifier">proc_server</span><span class="special">.</span><span class="identifier">wait</span><span class="special">();</span>
		<span class="identifier">proc_client</span><span class="special">.</span><span class="identifier">wait</span><span class="special">();</span>
		<span class="identifier">co_return</span> <span class="number">0</span><span class="special">;</span>
	<span class="special">}</span>
	<span class="identifier">co_return</span> <span class="number">0</span><span class="special">;</span>
<span class="special">}</span>
</pre>
<h3>
<a name="cobalt_beast_http_cpp_boost.h2"></a>
      <span class="phrase"><a name="cobalt_beast_http_cpp_boost.output"></a></span><a class="link" href="cobalt_beast_http_cpp_boost.html#cobalt_beast_http_cpp_boost.output">output:</a>
    </h3>
<pre class="programlisting"><span class="identifier">server</span> <span class="identifier">program</span> <span class="identifier">is</span> <span class="identifier">running</span> <span class="special">...</span>


<span class="identifier">Http</span> <span class="identifier">server</span> <span class="identifier">is</span> <span class="identifier">listening</span> <span class="identifier">on</span> <span class="number">0.0</span><span class="special">.</span><span class="number">0.0</span> <span class="number">4567</span> <span class="special">....</span>
<span class="identifier">client</span> <span class="identifier">program</span> <span class="identifier">is</span> <span class="identifier">running</span> <span class="special">...</span>


<span class="identifier">client</span> <span class="identifier">said</span><span class="special">:</span> <span class="identifier">request</span> <span class="identifier">server</span> <span class="special">...</span>
<span class="identifier">server</span> <span class="identifier">said</span><span class="special">:</span> <span class="identifier">a</span> <span class="identifier">session</span> <span class="identifier">is</span> <span class="identifier">created</span><span class="special">.</span>
<span class="identifier">server</span> <span class="identifier">said</span><span class="special">:</span> <span class="identifier">session</span> <span class="identifier">is</span> <span class="identifier">closed</span><span class="special">.</span>
<span class="identifier">client</span> <span class="identifier">said</span><span class="special">:</span> <span class="identifier">Got</span><span class="special">:</span>
<span class="special">&lt;</span><span class="identifier">html</span><span class="special">&gt;&lt;</span><span class="identifier">head</span><span class="special">&gt;&lt;</span><span class="identifier">title</span><span class="special">&gt;</span><span class="identifier">c</span><span class="special">++&lt;/</span><span class="identifier">title</span><span class="special">&gt;&lt;/</span><span class="identifier">head</span><span class="special">&gt;&lt;</span><span class="identifier">body</span><span class="special">&gt;</span><span class="identifier">Hello</span> <span class="identifier">c</span><span class="special">++!&lt;/</span><span class="identifier">body</span><span class="special">&gt;&lt;/</span><span class="identifier">html</span><span class="special">&gt;</span>


<span class="identifier">Http</span> <span class="identifier">server</span> <span class="identifier">is</span> <span class="identifier">listening</span> <span class="identifier">on</span> <span class="number">0.0</span><span class="special">.</span><span class="number">0.0</span> <span class="number">4567</span> <span class="special">....</span>
<span class="special">============================================================</span>


<span class="identifier">client</span> <span class="identifier">said</span><span class="special">:</span> <span class="identifier">request</span> <span class="identifier">server</span> <span class="special">...</span>
<span class="identifier">server</span> <span class="identifier">said</span><span class="special">:</span> <span class="identifier">a</span> <span class="identifier">session</span> <span class="identifier">is</span> <span class="identifier">created</span><span class="special">.</span>
<span class="identifier">server</span> <span class="identifier">said</span><span class="special">:</span> <span class="identifier">session</span> <span class="identifier">is</span> <span class="identifier">closed</span><span class="special">.</span>


<span class="identifier">Http</span> <span class="identifier">server</span> <span class="identifier">is</span> <span class="identifier">listening</span> <span class="identifier">on</span> <span class="number">0.0</span><span class="special">.</span><span class="number">0.0</span> <span class="number">4567</span> <span class="special">....</span>
<span class="identifier">client</span> <span class="identifier">said</span><span class="special">:</span> <span class="identifier">Got</span><span class="special">:</span>
<span class="special">&lt;</span><span class="identifier">html</span><span class="special">&gt;&lt;</span><span class="identifier">head</span><span class="special">&gt;&lt;</span><span class="identifier">title</span><span class="special">&gt;</span><span class="identifier">c</span><span class="special">++&lt;/</span><span class="identifier">title</span><span class="special">&gt;&lt;/</span><span class="identifier">head</span><span class="special">&gt;&lt;</span><span class="identifier">body</span><span class="special">&gt;</span><span class="identifier">Hello</span> <span class="identifier">c</span><span class="special">++!&lt;/</span><span class="identifier">body</span><span class="special">&gt;&lt;/</span><span class="identifier">html</span><span class="special">&gt;</span>
<span class="special">============================================================</span>


<span class="identifier">client</span> <span class="identifier">said</span><span class="special">:</span> <span class="identifier">request</span> <span class="identifier">server</span> <span class="special">...</span>
<span class="identifier">server</span> <span class="identifier">said</span><span class="special">:</span> <span class="identifier">a</span> <span class="identifier">session</span> <span class="identifier">is</span> <span class="identifier">created</span><span class="special">.</span>
<span class="identifier">server</span> <span class="identifier">said</span><span class="special">:</span> <span class="identifier">session</span> <span class="identifier">is</span> <span class="identifier">closed</span><span class="special">.</span>
<span class="identifier">client</span> <span class="identifier">said</span><span class="special">:</span> <span class="identifier">Got</span><span class="special">:</span>
<span class="special">&lt;</span><span class="identifier">html</span><span class="special">&gt;&lt;</span><span class="identifier">head</span><span class="special">&gt;&lt;</span><span class="identifier">title</span><span class="special">&gt;</span><span class="identifier">c</span><span class="special">++&lt;/</span><span class="identifier">title</span><span class="special">&gt;&lt;/</span><span class="identifier">head</span><span class="special">&gt;&lt;</span><span class="identifier">body</span><span class="special">&gt;</span><span class="identifier">Hello</span> <span class="identifier">c</span><span class="special">++!&lt;/</span><span class="identifier">body</span><span class="special">&gt;&lt;/</span><span class="identifier">html</span><span class="special">&gt;</span>


<span class="identifier">Http</span> <span class="identifier">server</span> <span class="identifier">is</span> <span class="identifier">listening</span> <span class="identifier">on</span> <span class="number">0.0</span><span class="special">.</span><span class="number">0.0</span> <span class="number">4567</span> <span class="special">....</span>
<span class="special">============================================================</span>


<span class="identifier">client</span> <span class="identifier">said</span><span class="special">:</span> <span class="identifier">request</span> <span class="identifier">server</span> <span class="special">...</span>
<span class="identifier">server</span> <span class="identifier">said</span><span class="special">:</span> <span class="identifier">a</span> <span class="identifier">session</span> <span class="identifier">is</span> <span class="identifier">created</span><span class="special">.</span>
<span class="identifier">server</span> <span class="identifier">said</span><span class="special">:</span> <span class="identifier">session</span> <span class="identifier">is</span> <span class="identifier">closed</span><span class="special">.</span>


<span class="identifier">Http</span> <span class="identifier">server</span> <span class="identifier">is</span> <span class="identifier">listening</span> <span class="identifier">on</span> <span class="number">0.0</span><span class="special">.</span><span class="number">0.0</span> <span class="number">4567</span> <span class="special">....</span>
<span class="identifier">client</span> <span class="identifier">said</span><span class="special">:</span> <span class="identifier">Got</span><span class="special">:</span>
<span class="special">&lt;</span><span class="identifier">html</span><span class="special">&gt;&lt;</span><span class="identifier">head</span><span class="special">&gt;&lt;</span><span class="identifier">title</span><span class="special">&gt;</span><span class="identifier">c</span><span class="special">++&lt;/</span><span class="identifier">title</span><span class="special">&gt;&lt;/</span><span class="identifier">head</span><span class="special">&gt;&lt;</span><span class="identifier">body</span><span class="special">&gt;</span><span class="identifier">Hello</span> <span class="identifier">c</span><span class="special">++!&lt;/</span><span class="identifier">body</span><span class="special">&gt;&lt;/</span><span class="identifier">html</span><span class="special">&gt;</span>
<span class="special">============================================================</span>
</pre>
<p>
      ...
    </p>
<p>
      ...
    </p>
<p>
      ...
    </p>
<h2>
<a name="cobalt_beast_http_cpp_boost.h3"></a>
      <span class="phrase"><a name="cobalt_beast_http_cpp_boost.role_cyan_github"></a></span><a class="link" href="cobalt_beast_http_cpp_boost.html#cobalt_beast_http_cpp_boost.role_cyan_github"><span class="cyan">github</span></a>
    </h2>
<p>
      <a href="https://github.com/fasxmut/cobalt-cpp-examples" target="_top">https://github.com/fasxmut/cobalt-cpp-examples</a>
    </p>
<h2>
<a name="cobalt_beast_http_cpp_boost.h4"></a>
      <span class="phrase"><a name="cobalt_beast_http_cpp_boost.cpp-lang"></a></span><a class="link" href="cobalt_beast_http_cpp_boost.html#cobalt_beast_http_cpp_boost.cpp-lang"><span class="cyan">cpp/c++</span></a>
    </h2>
<p>
      c++ std::exception:
    </p>
<p>
      std::cout.write(err.data(), err.size());
    </p>
<p>
      std::cout &lt;&lt; std::endl;
    </p>
<p>
      <span class="purple">caught:</span>
    </p>
<pre class="programlisting">  ==================================================
  #        The c++ programming language.           #
  #                                                #
  #        Join c++ Discord: yZcauUAUyC            #
  #        Deck                                    #
  ==================================================
</pre>
<p>
      <a href="https://cppfx.xyz" target="_top">Home: cppfx.xyz</a>
    </p>
<p>
      <a href="https://cppfx.xyz/kjcpp/kjcpp-print.html" target="_top">K</a>
    </p>
</div>
<div class="copyright-footer"></div>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="cobalt_main_entry_points_cpp_boo.html"><img src="images/prev.png" alt="Prev"></a><a accesskey="u" href="index.html"><img src="images/up.png" alt="Up"></a><a accesskey="h" href="index.html"><img src="images/home.png" alt="Home"></a><a accesskey="n" href="cobalt_op_what_is_it_cpp_boost.html"><img src="images/next.png" alt="Next"></a>
</div>
</body>
</html>
